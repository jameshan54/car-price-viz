let currentScene = 0;
let data = [];

// Load the CSV dataset
d3.csv("data/car_prices.csv").then(dataset => {
  data = dataset;
  preprocess(data);
  drawScene(currentScene);
});

// Preprocess data: convert types and assign seasons
function preprocess(data) {
  data.forEach(d => {
    d.Price = +d.Price;
    d.Year = +d.Year;
    d.Month = +d.Month;
    d.Season = getSeason(d.Month);
  });
}

// Determine season from month
function getSeason(month) {
  month = +month;
  if ([12, 1, 2].includes(month)) return "Winter";
  if ([6, 7, 8].includes(month)) return "Summer";
  return "Other";
}

// Draw the appropriate scene based on currentScene
function drawScene(scene) {
  d3.select("#vis").html(""); // Clear previous content

  if (scene === 0) drawScene0();
  else if (scene === 1) drawScene1();
  else if (scene === 2) drawScene2();
  else if (scene === 3) drawScene3();
}

// Button event listeners for navigating scenes
d3.select("#next").on("click", () => {
  if (currentScene < 3) currentScene++;
  drawScene(currentScene);
});

d3.select("#prev").on("click", () => {
  if (currentScene > 0) currentScene--;
  drawScene(currentScene);
});

// Scene definitions
function drawScene0() {
  d3.select("#vis").append("p").text("Scene 0: Overall Price Distribution");
}

function drawScene1() {
  d3.select("#vis").append("p").text("Scene 1: Average Price by Year");
}

function drawScene2() {
  d3.select("#vis").append("p").text("Scene 2: Seasonal Price Comparison");
}

function drawScene3() {
  d3.select("#vis").append("p").text("Scene 3: Interactive Exploration");
}
